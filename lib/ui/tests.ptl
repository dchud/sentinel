from quixote import get_publisher

from canary.utils import do_query

def test_session [html] (request):
    session = request.session
    user = session.user

    if session is None:
        'There is no session.'
    elif user is None:
        'There is no user.  Creating one now.'
        session.user = str('Anonymous')
        session.dirty()
    else:
        """
        Greetings, user '%(user)s'.
        """ % vars()

def test_session_dir [html] (request):
    session = request.session

    '<h3>dir(request):</h3>'
    for att in dir(request):
        '<li>%s</li><br />\n' % att

    '<h3>dir(session):</h3>'
    for att in dir(request.session):
        '<li>%s</li><br />\n' %att

def test_cursor [html] (request):
    '<h3>attempting to get_cursor</h3>'
    cursor = get_publisher().get_cursor()
    '<h3>got cursor, closing</h3>'
    r = do_query(cursor, str('SELECT * FROM foo'))
    for row in r:
        if row == None: break
        '<li>%(row)s</li>\n' % vars()
    cursor.close()
    '<h3>cursor closed.</h3>'
